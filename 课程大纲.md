# 区块链后端开发培训课程（37天 · Go + Foundry）

## 课程设计理念

**目标人群**：具备扎实服务端开发经验（Golang），理解数据库、网络、分布式系统基础，但零区块链经验的开发者。

**核心目标**：在 37 天内掌握 **Bitcoin + EVM 双技术栈**，理解 UTXO 与 Account 两大模型，具备支付系统、资产托管、DeFi 应用、跨链开发的能力。

**核心逻辑**：利用 Go 语言在区块链基础设施（节点、索引、钱包）中的统治地位，结合 Foundry 进行合约开发，构建"重后端、轻前端"的极客技术栈。

**技术栈**：
* **智能合约**：Solidity + Foundry (Rust编写的极速测试框架，无需写 TS)
* **后端服务**：Golang (go-ethereum/btcsuite)
* **AI 辅助**：Cursor/Windsurf (负责生成测试脚手架、复杂脚本、前端展示)
* **数据库**：MySQL/PostgreSQL + Redis (热数据/Merkle Cache)

**教学方法**：对比教学法（Bitcoin vs Ethereum / Web2 vs Web3）+ Project-Based Learning (PBL)。

**每日学习时间**：建议 4-6 小时（理论 1.5h + 实战 3-4h + 复习 0.5h）

---

## 课程结构总览

```
Week 1: 区块链基础 + Bitcoin 核心
├── Day 1-2: 区块链通用基础与密码学
├── Day 3-4: Bitcoin UTXO 与 PSBT 协同
├── Day 5-6: Bitcoin 时间锁与支付系统
├── Day 7: Week 1 复习与 Mini Project

Week 2: 闪电网络 + EVM 基础
├── Day 8-10: 闪电网络 Layer 2 与 LND 开发
├── Day 11-12: 以太坊基础与 Go 客户端 + Foundry 入门
├── Day 13: Solidity 基础语法与 ERC-20
├── Day 14: Week 2 整合与 Mini Project

Week 3: 合约进阶与 Go 集成
├── Day 15: Solidity 进阶 (ABI + 存储布局 + Proxy)
├── Day 16: Abigen 合约绑定与 Go 集成
├── Day 17: Go + Anvil E2E 集成测试
├── Day 18-19: 高性能事件监听与 Indexer
├── Day 20-21: Week 3 整合与 Mini Project

Week 4: Merkle Tree、资产标准与 DeFi
├── Day 22-23: Merkle Tree 实战与储备金证明
├── Day 24-25: 资产标准 (Permit / USDC Proxy / NFT)
├── Day 26-27: 账户抽象 (ERC-4337) 与 Gasless 交易
├── Day 28-29: DeFi 协议集成 (Uniswap / Aave)
├── Day 30: Week 4 整合与 Mini Project

Week 5: 安全、跨链与结业项目
├── Day 31-32: 资产托管 (冷热分离 + Gnosis Safe)
├── Day 33-34: 跨链与 L2 开发 (CrossDomainMessenger)
├── Day 35: 安全与合规 (MEV / Flashbots / 审计)
├── Day 36-37: 结业项目
```

---

## 第一阶段：区块链基础 + Bitcoin 核心 (Day 1-7)

### Day 1: 区块链核心概念 —— 从数据库到分布式账本

* **理论课**：
    * **什么是区块链**：分布式账本 vs 中心化数据库。
    * **核心特性**：不可篡改、去中心化、透明性、抗审查。
    * **共识机制概览**：PoW (Bitcoin) vs PoS (Ethereum)。
    * **后端视角的架构理解**：
        * Block → Log Segment / WAL (Write-Ahead Log)
        * Transaction → Database Transaction
        * Hash → 数据完整性校验
        * Merkle Tree → 高效验证结构
        * State Machine：状态转换函数 `S(t+1) = Apply(S(t), Block(t))`
* **实战作业**：
    * 在 [blockchain.com](https://blockchain.com) 和 [etherscan.io](https://etherscan.io) 上浏览区块和交易。
    * 对比 Bitcoin 交易和 Ethereum 交易的结构差异。
    * Go 实战：解析区块头结构，理解 Merkle Root 在数据完整性校验中的作用。

### Day 2: 密码学基础与钱包原理

* **理论课**：
    * **非对称加密**：公钥、私钥、数字签名 (ECDSA)。
    * **哈希函数**：SHA-256 (Bitcoin), Keccak-256 (Ethereum)。
    * **地址生成**：
        * Bitcoin: Base58Check / Bech32
        * Ethereum: Hex (0x...)
    * **助记词标准 (BIP-39)**：熵 → 助记词 → 种子。
    * **HD 钱包 (BIP-32/44)**：派生路径详解。
* **实战作业**：
    * 使用 Go (`btcsuite` 和 `go-ethereum/crypto`) 生成地址。
    * **挑战**：不依赖库，手动实现从私钥到地址的推导流程（理解压缩公钥、校验和）。
    * 使用 btcsuite 生成 1000 个派生地址，从同一助记词派生两条链的地址。

### Day 3: Bitcoin 核心 —— UTXO 模型详解

* **理论课**：
    * **UTXO vs Account 模型**：核心差异与设计哲学。
    * **难点**：没有"账户余额"概念，只有"未花费的输出"。
    * **交易结构**：Inputs, Outputs, Fees。
    * **UTXO 优势与挑战**：并发验证 vs 状态管理。
    * **Coin Selection**：UTXO 选择算法（贪婪算法、分支定界）。
* **AI 辅助**：使用 AI IDE 画出 UTXO 的图结构，理解 Input 指向之前交易的 Output。
* **实战作业**：
    * 使用 Bitcoin 测试网水龙头获取测试币。
    * 编写 Go 脚本查询地址余额（需遍历 UTXO）。
    * 调用 Bitcoin RPC (`listunspent`)。
    * 编写 `UTXOSelector`：实现简单的"找零算法" (Coin Selection)。

### Day 4: PSBT (部分签名交易) —— 现代化多方协同

* **理论课**：
    * **Script 基础**：脚本类型概览 (P2PKH, P2SH, SegWit, Taproot)。
    * **PSBT 标准 (BIP-174)**：Partially Signed Bitcoin Transaction。
    * **为什么用 PSBT**：硬件钱包集成、多签协作、交易审计。
    * **PSBT 工作流**：Creator → Updater → Signer(s) → Combiner → Finalizer → Extractor。
    * **多重签名 (Multisig)**：2-of-3 方案设计与 PSBT 结合。
* **实战作业**：
    * 使用 Go (`btcsuite/btcutil/psbt`) 创建 PSBT。
    * 实现多方签名流程：构造 PSBT → 分发给多个签名者 → 收集签名 → 合并 → 广播。
    * **挑战**：模拟冷钱包场景，在线机器构建 PSBT，离线机器签名。

### Day 5: Bitcoin 时间锁 —— 高级条件控制

* **理论课**：
    * **时间锁机制**：nLockTime, Sequence, CLTV (CheckLockTimeVerify), CSV (CheckSequenceVerify)。
    * **绝对时间锁 vs 相对时间锁**：应用场景对比。
    * **实际应用**：
        * 定时支付 / 延迟提款
        * 闪电网络基础（HTLC 的时间锁部分）
        * 遗产规划 / 多阶段解锁
    * **与 PSBT 结合**：锁定到未来时间的多签交易。
* **实战作业**：
    * 使用 Go 构造带 CLTV 的交易：资金锁定到指定区块高度后才能花费。
    * **挑战**：实现"取消支付"场景——发送者可在 24 小时内取消，否则接收者可领取。

### Day 6: Bitcoin 支付系统开发

* **理论课**：
    * **节点与 API**：Bitcoin Core RPC, Btcd。
    * **SPV 钱包**：轻客户端原理。
    * **交易广播与确认**：Mempool, RBF (Replace-By-Fee)。
    * **支付场景设计**：收款监听, 归集策略。
    * **Watcher 架构**：RPC 轮询 vs ZMQ 订阅，事件驱动设计。
* **实战作业**：
    * **Go 后端服务**：
        * 集成 `btcd` 或 `bitcoind` RPC。
        * 生成收款地址并监听 `0-conf` 和 `6-conf` 事件。
    * 实现 `DepositWatcher`：监听特定地址的入账。
    * **Reorg 处理**：设计数据库字段 `confirmation_count`，处理区块回滚。
    * 设计幂等的充值处理逻辑。

### Day 7: Week 1 复习与 Mini Project

* **复习**：回顾 Bitcoin 技术栈核心知识点。
* **Mini Project**：构建完整的 Bitcoin 收款监听服务。
    * 地址生成 (HD Wallet) + UTXO 追踪 + Reorg 处理 + 数据库持久化。
    * **E2E 测试要求**：使用 Bitcoin Regtest 模式编写集成测试，验证：
        * 正常充值流程
        * Reorg 回滚场景
        * 多确认阈值切换

---

## 第二阶段：闪电网络 + EVM 基础 (Day 8-14)

### Day 8: 闪电网络 —— Layer 2 支付通道

* **理论课**：
    * **支付通道**：Funding, Commitment, Closing。
    * **HTLC**：哈希时间锁合约。
    * **路由与发票**：BOLT-11 标准。
* **实战作业**：
    * 在 Polar 环境中搭建 LND 节点网络。
    * 手动完成开通道、支付、关通道流程。

### Day 9: 闪电网络开发 —— LND (Go)

* **理论课**：
    * **LND 架构**：纯 Go 实现的闪电网络节点。
    * **gRPC API 集成**：
        * Invoice 管理
        * 支付流订阅
        * 通道管理
    * **Macaroon**：鉴权机制。
* **实战作业**：
    * 使用 Go 编写 LND 客户端 (`lightning-network/lnd/lnrpc`)。
    * 实现：生成发票 -> 监听支付 -> 触发回调。
    * **(选修)**：阅读 lnd 源码中 `htlcswitch` 包，理解它是如何用 Go 处理并发状态机的。

### Day 10: 以太坊基础 —— Account 模型与 EVM

* **理论课**：
    * **Account 模型**：EOA vs Contract。
    * **EVM 架构**：Storage, Memory, Stack。
    * **MPT (Merkle Patricia Trie)**：状态存储原理。
    * **Gas 机制**。
    * **交易结构**。
* **实战作业**：
    * 配置 Go 开发环境 (`go-ethereum`)。
    * 连接 Sepolia 节点 (Infura/Alchemy) 或搭建本地 Geth 测试节点。
    * 查询区块头信息和账户余额。

### Day 11: 以太坊交易与 Go 客户端开发

* **理论课**：
    * **go-ethereum (geth)**：官方 Go 客户端库详解。
    * **交易构造**：Nonce 处理, Gas 估算, 签名 (EIP-155)。
    * **交易生命周期**。
    * **Keystore 管理**：加密私钥存储。
    * **RPC 性能优化**：
        * **痛点**：公共 RPC 不稳定，频繁调用易被限流。
        * **Multicall (批量调用)**：将多个 `eth_call` 合并为一次调用，减少 RPC 开销。
        * **Rate Limiting (流控)**：使用令牌桶/漏桶算法控制请求频率。
* **实战作业**：
    * 使用 Go 发送 ETH 转账交易。
    * 实现一个简单的钱包 CLI：生成账户、导入 Keystore、转账。
    * 封装 `EthClient`：
        * Failover (故障切换)：多 RPC 节点自动切换。
        * **Multicall 集成**：批量查询多个地址余额和 Token 信息。
        * **Rate Limiter**：实现请求限流，避免被 RPC 节点封禁。
    * **挑战**：实现基于 Redis 的 Nonce 管理器，防止并发冲突。

### Day 12: 合约开发 —— 拥抱 Foundry

* **工具安装**：安装 Foundry (`curl -L https://foundry.paradigm.xyz | bash`)
* **Foundry 优势**：
    * 测试代码用 Solidity 写，运行速度极快。
    * 自带 Fuzzing 测试。
    * 无需 JavaScript/TypeScript 环境。
* **实战**：
    * `forge init` 初始化项目。
    * 编写 Counter / Bank 合约。
    * 测试：编写 `Bank.t.sol`，测试存取款逻辑。
    * **AI 任务**：让 Cursor 生成测试用例模板："Generate a comprehensive test suite for this Bank contract using Foundry syntax."

### Day 13: Solidity 基础语法与 ERC-20

* **理论课**：
    * **Solidity 数据类型**：值类型、引用类型、映射。
    * **函数可见性**：public, external, internal, private。
    * **修饰器 (Modifier)**：权限控制、重入保护。
    * **事件 (Events)**：链上日志与前端监听。
* **实战作业**：
    * 编写 ERC-20 基础合约。
    * 使用 Foundry 的 `fuzz` 功能测试合约安全性（例如：随机输入极大的金额，看合约是否溢出或锁死）。
    * 使用 `cast` 命令行工具直接与链交互，体验"命令行版的小狐狸"。

### Day 14: Week 2 整合与 Mini Project

* **复习**：回顾闪电网络与 EVM 基础核心知识点。
* **Mini Project**：构建简单的 ERC-20 代币与测试套件。
    * 使用 Foundry 编写完整的单元测试和 Fuzzing 测试。
    * 部署到 Sepolia 测试网。
    * **验收标准**：
        * 合约通过所有测试
        * 成功部署并在 Etherscan 上验证合约源码

---

## 第三阶段：合约进阶与 Go 集成 (Day 15-21)

### Day 15: Solidity 进阶 —— ABI 与存储布局

* **理论课**：
    * **ABI 编码规则**：静态类型、动态类型的编码差异。
    * **合约调用类型**：Call vs Delegatecall vs Staticcall 的区别与安全考量。
    * **存储布局 (Storage Slots)**：理解 Slot 计算规则。
    * **Proxy 模式基础**：透明代理与 UUPS 代理。
* **实战作业**：
    * 使用 `forge inspect` 查看合约存储布局。
    * 编写简单的可升级代理合约。
    * 理解 `delegatecall` 的存储共享机制。

### Day 16: Abigen 合约绑定与 Go 集成

* **理论课**：
    * **原生合约绑定**：`abigen` 工具详解。
    * **ABI → Go Struct**：自动生成强类型 Go 代码。
    * **部署与调用**：在 Go 中部署合约、调用 View 函数 (Call)、调用状态函数 (Transact)。
    * **Filter Logs**：在 Go 中过滤和解析事件。
* **实战作业**：
    * 使用 `abigen` 为 ERC-20 合约生成 Go 绑定文件。
    * 编写 Go 程序：部署合约 → 调用方法 → 监听事件。
    * 编写服务：监听链上 Transfer 事件，自动过滤大额交易。

### Day 17: Go + Anvil E2E 集成测试

* **理论课**：
    * **Anvil 进阶功能**：快照、时间跳跃、Mainnet 分叉。
    * **测试架构设计**：Go 后端 + Anvil 的 E2E 验证策略。
    * **测试隔离**：`evm_snapshot` / `evm_revert` 确保测试独立。
    * **时间控制**：`evm_increaseTime` / `evm_mine` 模拟时间流逝。
* **实战作业**：
    * 使用 `go test` + `exec.Command` 启动 Anvil。
    * 编写完整 E2E 测试套件：部署 → 交易 → 验证 → 清理。
    * **挑战**：测试时间锁合约——使用 `evm_increaseTime` 模拟 24 小时后解锁。

### Day 18: 高性能事件监听 (Custom Indexer I)

* **理论课**：
    * **为什么不一定用 The Graph**：私有数据、实时性要求、复杂业务逻辑。
    * **Ethclient 订阅**：Websocket 订阅 `SubscribeFilterLogs`。
    * **轮询机制**：HTTP 轮询 (`FilterLogs`) 作为保底。
    * **数据一致性**：如何处理区块重组 (Chain Reorg)。
* **实战作业**：
    * 设计一个 `LogWatcher` 服务 (Go)。
    * 实现：实时通道消费事件 + 定时任务补漏。
    * **核心逻辑**：检测到区块回滚时，自动回滚数据库状态。

### Day 19: 链下索引器架构 (Custom Indexer II)

* **理论课**：
    * **并发区块扫描**：使用 Go Routines 并发拉取历史日志。
    * **数据存储**：设计适合区块链数据的 DB Schema (BlockHeight, TxHash, LogIndex)。
    * **任务队列**：通过 Kafka/Redis 解耦"监听"与"业务处理"。
    * **幂等性**：保证事件不被重复处理。
* **挑战**：EVM 的 `uint256` 超过 MySQL BIGINT 范围。
    * 存储策略：`DECIMAL(78, 0)` vs 字符串存储。
    * Go 处理：`math/big.Int` 与数据库类型的序列化/反序列化。
* **实战作业**：
    * **构建 Indexer**：扫描 ERC-20 合约所有历史 Transfer 事件。
    * **存储**：存入 MySQL/PostgreSQL，设计高效的表结构。
    * **API**：提供 `GET /balance/:address` 接口。

### Day 20-21: Week 3 复习与 Mini Project

* **复习**：回顾合约开发与 Go 集成核心知识点。
* **Mini Project**：构建完整的合约测试与监听服务。
    * 合约部署 + E2E 测试套件 + 事件监听 + REST API。
    * **E2E 测试要求**：使用 Anvil 编写集成测试，覆盖：
        * 合约部署与初始化
        * 正常业务流程
        * 边界条件与异常处理

---

## 第四阶段：Merkle Tree 与资产标准 (Day 22-28)

### Day 22: Merkle Tree 实战 I —— 原理与构建

* **场景**：交易所储备金证明 / 白名单验证 / 状态快照。
* **架构**：Redis (作为缓存层) + MySQL (持久化)。
* **Go 实战**：
    * 构建：用 Go 读取 10 万条模拟用户余额数据。
    * 计算：在内存中构建 Merkle Tree (使用 `github.com/cbergoon/merkletree` 或自写)。
    * 存储：将 Merkle Root 存入 MySQL，将中间节点存入 Redis。

### Day 23: Merkle Tree 实战 II —— 验证与应用

* **Go 实战**：
    * 验证：编写 API `Verify(user, proof)`，无需全量数据验证用户包含在树中。
    * 导出：生成 Merkle Proof 供用户下载。
    * **扩展**：理解 Merkle Patricia Trie 在以太坊状态存储中的应用。

### Day 24: 资产标准与 Token 处理

* **理论课**：
    * **ERC-20 / ERC-721 / ERC-1155** 标准详解。
    * **EIP-2612 Permit (无 Gas 授权)**：
        * 用户签名授权，无需先调用 `approve`。
        * 应用场景：Gasless 交易、更好的 UX。
        * 签名结构：`permit(owner, spender, value, deadline, v, r, s)`。
    * **USDC 与 Proxy 模式**：
        * USDC 使用可升级代理合约，需注意 Implementation 合约差异。
        * 如何正确解析 Proxy 合约的 ABI 和事件。
    * **Go 处理 Token**：
        * 精度处理 (`math/big`) —— **非常重要**，切勿用 float。
* **实战作业**：
    * (合约侧) 部署支持 Permit 的 ERC-20 合约 (继承 OpenZeppelin ERC20Permit)。
    * (Go 后端) 实现 Permit 签名生成与验证。
    * (Go 后端) 编写 USDC 解析器：通过 Proxy 合约获取真实 Implementation ABI。

### Day 25: NFT 与资产解析

* **理论课**：
    * **ERC-721 / ERC-1155** 深入：tokenURI, baseURI, 元数据标准。
    * **链上 vs 链下存储**：IPFS, Arweave, 中心化存储对比。
* **AI 技巧**：不要手写解析代码。
    * Prompt: "Write a Go struct and parser for ERC-721 metadata JSON."
* **实战作业**：
    * 部署 ERC-721 NFT 合约。
    * 编写 Go 服务自动抓取并解析 NFT Metadata (JSON + 图片)。
    * 编写通用的 `TokenParser` 服务，支持批量解析和缓存优化。

### Day 26: 账户抽象 (ERC-4337) —— 理论与架构

* **理论课**：
    * **传统账户的局限**：EOA 必须持有 ETH、单签、无法批量操作。
    * **ERC-4337 核心概念**：
        * **UserOperation**：用户意图的数据结构。
        * **Bundler**：收集并提交 UserOps 的服务。
        * **EntryPoint**：链上统一入口合约。
        * **Paymaster**：Gas 代付合约。
    * **智能合约钱包 vs EOA**：优势与权衡。
    * **应用场景**：社交恢复、Session Keys、批量交易、Gas 抽象。
* **实战作业**：
    * 阅读 ERC-4337 规范，理解 UserOperation 字段含义。
    * 使用 Foundry 部署 SimpleAccount 合约。
    * 使用 Go 构造第一个 UserOperation。

### Day 27: 账户抽象 (ERC-4337) —— 实战与 Paymaster

* **理论课**：
    * **Paymaster 深入**：
        * Verifying Paymaster：验证用户资格后代付。
        * Token Paymaster：用户用 ERC-20 支付 Gas。
    * **Bundler 对接**：Stackup / Pimlico / Alchemy。
    * **安全考虑**：防签名重放、Nonce 管理。
* **实战作业**：
    * (Go 后端) 完整实现 UserOperation 构造 → 签名 → 广播到 Bundler。
    * 部署 Verifying Paymaster，实现白名单用户免 Gas。
    * **挑战**：实现 Token Paymaster，接受 USDC 作为 Gas 费。

### Day 28: DeFi 协议集成 —— DEX 原理与 Uniswap

* **理论课**：
    * **AMM 原理**：
        * **恒定乘积公式**：x * y = k。
        * **流动性池**：LP Token、添加/移除流动性。
        * **无常损失 (Impermanent Loss)**：原理与计算。
    * **Uniswap V3 特性**：
        * 集中流动性、Tick 机制、价格区间。
        * SwapRouter vs QuoterV2。
    * **Go 后端对接**：
        * `abigen` 生成 Router 绑定。
        * 报价查询、滑点计算、交易执行。
* **实战作业**：
    * 使用 Go 查询 Uniswap V3 报价。
    * 实现 `swap()` 功能：指定输入/输出金额进行兑换。
    * 计算并设置滑点保护参数。

### Day 29: DeFi 协议集成 —— 借贷协议与 Flash Loan

* **理论课**：
    * **借贷协议 (Aave/Compound)**：
        * 超额抵押借贷模型。
        * 健康因子 (Health Factor) 与清算机制。
        * 利率模型：浮动利率 vs 稳定利率。
    * **Flash Loan**：
        * 原理：同一交易内借还，无需抵押。
        * 应用场景：套利、清算、抵押品置换。
        * 安全风险：重入、价格操控。
    * **Go 后端对接**：
        * Aave Pool 合约绑定。
        * 查询用户资产、健康因子、可借额度。
* **实战作业**：
    * (Go 后端) 查询 Aave 用户借贷位置。
    * (Go 后端) 监控健康因子，低于阈值发送告警。
    * **挑战**：实现简单的套利监控工具，比较不同 DEX 的价差。

### Day 30: Week 4 复习与 Mini Project

* **复习**：回顾 Merkle Tree、资产标准、AA 与 DeFi 核心知识点。
* **Mini Project**：构建完整的资产管理与 DeFi 服务。
    * Merkle Proof 导出 + Token 解析 + AA 钱包 + DeFi 查询 API。
    * **E2E 测试要求**：
        * Merkle Tree 构建与验证
        * AA UserOperation 完整流程
        * Uniswap Swap 调用
        * Aave 借贷位置查询

---

## 第五阶段：安全、跨链与结业项目 (Day 31-37)

### Day 31: 资产托管 —— 离线签名与冷热分离

* **理论课**：
    * **冷热分离架构**。
    * **安全原则**：私钥永远不触网。
    * **离线签名**：在断网机器上用 Go 构造并签名交易 (`types.SignTx`)。
* **架构设计**：
    * Online Service：构造未签名交易 (Unsigned Tx) → 传给内网机器。
    * Offline Service：签名 (Sign) → 返回 Signed Tx → Online Service 广播。
* **实战作业**：
    * 实现一个离线签名工具：输入私钥和交易参数，输出 Signed Hex。
    * 实现上述冷热分离流程的 Demo。

### Day 32: 资产托管 —— Gnosis Safe 多签与归集

* **理论课**：
    * **Gnosis Safe (Safe{Core})**：企业级多签标准。
    * **Safe 对接**：通过 Go 提议和执行多签交易。
    * **资金归集算法**：基于 UTXO (BTC) 和 Balance (ETH) 的归集策略。
* **实战作业**：
    * 对接 Gnosis Safe API，实现多签交易提议。
    * 构建自动归集服务：监测热钱包余额 > 阈值时触发归集。

### Day 33: 跨链基础与 L2 架构

* **理论课**：
    * **跨链桥原理**：Lock-Mint / Burn-Unlock 模式。
    * **L2 架构对比**：Optimistic Rollup (Optimism, Arbitrum) vs ZK Rollup。
    * **多链监听架构**：如何在 Go 中管理多个 Client (ChainID 路由)。
    * **RPC 高可用**：多节点负载均衡与故障切换。
* **实战作业**：
    * 设计一个 `MultiChainClient` 接口。
    * 同时监听 Sepolia (L1) 和 Optimism Sepolia (L2) 的事件。

### Day 34: L2 开发与 CrossDomainMessenger

* **理论课**：
    * **L1 ↔ L2 消息传递**：
        * **CrossDomainMessenger**：Optimism 官方跨层消息合约。
        * **L1 → L2**：`sendMessage()` 发送，L2 自动执行。
        * **L2 → L1**：需要等待 Challenge 期（7 天），调用 `proveMessage()` + `finalizeMessage()`。
    * **EVM 兼容链开发**：BSC, Polygon, Layer 2 差异。
    * **CREATE2**：确定的合约地址，支持跨链部署。
* **实战作业**：
    * 部署 L1/L2 配对合约，通过 CrossDomainMessenger 通信。
    * 实现简单的中心化跨链桥后端 (`BridgeRelayer`)：
        * 监听 A 链 Lock 事件。
        * 自动在 B 链发起 Mint 交易。
    * **挑战**：实现 L2 → L1 的提款证明流程。

### Day 35: 安全与合规 (MEV + Flashbots + 审计)

* **理论课**：
    * **MEV (最大可提取价值)**：为什么你的大额交易会被抢跑？
    * **后端安全**：
        * RPC 节点鉴权。
        * 私钥管理 (AWS KMS / Hashicorp Vault)。
    * **合约安全**：Reentrancy, Overflow, Flash Loan 攻击。
    * **合规**：接入链上分析工具 (Chainalysis / Elliptic) API。
* **实战作业**：
    * **Flashbots 集成**：使用 `github.com/metachris/flashbotsrpc`。
    * 编写代码：将交易通过 Flashbots 私有 RPC 发送，实现"防夹"。
    * 使用 Go 集成 AWS KMS（或模拟）进行交易签名。
    * 对 Slither 扫描出的合约漏洞进行修复。

### Day 36-37: 结业项目 —— 企业级双链支付网关 (Go版)

**项目描述**：
开发一个生产级的高性能支付网关，支持 **Bitcoin + Ethereum**。

#### 技术架构
* **合约**：Solidity (ERC-20, 归集逻辑) + Foundry 测试
* **后端核心**：Golang (Gin/Echo 框架)
* **索引/监听**：Golang Custom Indexer
* **数据库**：PostgreSQL (业务数据) + Redis (缓存/队列/Merkle Cache)

#### 核心模块

1. **Wallet Manager (Go)**:
    * 管理 BTC/ETH 地址池。
    * 集成 KMS 签名。

2. **Chain Watcher (Go)**:
    * **BTC Watcher**: 监听 UTXO 变动，处理 Reorg。
    * **ETH Watcher**: 监听 Log，使用 `abigen` 绑定。
    * 多线程监听区块，具备 `ReorgHandler` 和 `Failover`。

3. **Lightning Service (Go)**:
    * 集成 LND gRPC，处理秒级支付。

4. **Signer (Go, 独立进程)**:
    * 加载加密 Keystore，仅通过 gRPC 接收待签名请求。
    * 支持 Gnosis Safe 多签流程。

5. **Broadcaster (Go)**:
    * 负责将签名后的交易上链。
    * 支持通过 Flashbots 发送（防 MEV）。

6. **API Gateway**:
    * 统一商户接口。
    * `POST /withdraw`: 提现接口 (鉴权 → 估算 Gas → 构造交易 → 签名 → 广播)。

#### 交付物
* `/contracts`: Solidity 源码 + Foundry 测试报告。
* `/backend`: 
    * `/pkg/chain`: 封装的 BTC/ETH 客户端。
    * `/internal/watcher`: 监听服务。
    * `/internal/signer`: 签名服务。
    * `/internal/indexer`: 索引服务。
    * `main.go`: 入口与 DI 注入。
* **E2E 测试套件**：使用 Anvil + Bitcoin Regtest 的集成测试。
* `docker-compose.yml`: 一键启动 DB, LND, Anvil, Backend。
* 架构图 (使用 AI 辅助生成)。

---

## 学习路线图

### Week 1: 区块链基础 + Bitcoin 核心
| Day       | 主题          | 核心内容                                 |
| :-------- | :------------ | :--------------------------------------- |
| **Day 1** | 区块链基础    | 分布式账本、共识机制、状态机             |
| **Day 2** | 密码学与钱包  | 助记词、Go 生成地址/私钥                 |
| **Day 3** | UTXO 模型     | UTXO 选择、Coin Selection 算法           |
| **Day 4** | PSBT 多方协同 | PSBT 工作流、多签协作、冷钱包集成        |
| **Day 5** | 时间锁        | CLTV/CSV、定时支付、闪电网络基础         |
| **Day 6** | BTC 支付系统  | RPC 集成、Watcher、Reorg 处理            |
| **Day 7** | Week 1 整合   | Bitcoin 收款监听 Mini Project + E2E 测试 |

### Week 2: 闪电网络 + EVM 基础
| Day        | 主题              | 核心内容                              |
| :--------- | :---------------- | :------------------------------------ |
| **Day 8**  | 闪电网络基础      | 支付通道、HTLC                        |
| **Day 9**  | LND 开发          | Go gRPC 客户端、Invoice               |
| **Day 10** | 闪电网络整合      | 源码阅读、并发状态机                  |
| **Day 11** | ETH 基础          | Account 模型、EVM、MPT                |
| **Day 12** | Go 客户端+Foundry | Multicall、Failover、forge init       |
| **Day 13** | Solidity 基础     | 数据类型、函数可见性、ERC-20、Fuzzing |
| **Day 14** | Week 2 整合       | ERC-20 Mini Project、测试网部署       |

### Week 3: 合约进阶与 Go 集成
| Day           | 主题             | 核心内容                              |
| :------------ | :--------------- | :------------------------------------ |
| **Day 15**    | Solidity 进阶    | ABI、Storage Slots、Proxy 模式        |
| **Day 16**    | Abigen 绑定      | Go 合约调用、事件过滤                 |
| **Day 17**    | E2E 集成测试     | Go + Anvil、快照、时间控制            |
| **Day 18**    | Custom Indexer I | 实时监听、Reorg 处理                  |
| **Day 19**    | Indexer II       | 并发扫描、uint256 存储、幂等性        |
| **Day 20-21** | Week 3 整合      | 合约测试与监听服务 Mini Project + E2E |

### Week 4: Merkle Tree、资产标准与 DeFi
| Day        | 主题           | 核心内容                              |
| :--------- | :------------- | :------------------------------------ |
| **Day 22** | Merkle Tree I  | 原理、Go 构建、Redis 缓存             |
| **Day 23** | Merkle Tree II | Proof 验证、储备金证明                |
| **Day 24** | Token 标准     | Permit (EIP-2612)、USDC/Proxy 处理    |
| **Day 25** | NFT 与解析     | ERC-721/1155、Metadata 抓取           |
| **Day 26** | AA 理论        | ERC-4337 架构、UserOperation、Bundler |
| **Day 27** | AA 实战        | Paymaster、Token Gas、Go 集成         |
| **Day 28** | DeFi: Uniswap  | AMM 原理、V3 集中流动性、Swap 实现    |
| **Day 29** | DeFi: Aave     | 借贷协议、健康因子、Flash Loan        |
| **Day 30** | Week 4 整合    | 资产管理 + DeFi Mini Project + E2E    |

### Week 5: 安全、跨链与结业项目
| Day           | 主题           | 核心内容                             |
| :------------ | :------------- | :----------------------------------- |
| **Day 31**    | 离线签名       | 冷热分离架构                         |
| **Day 32**    | 多签托管       | Gnosis Safe、自动归集                |
| **Day 33**    | 跨链与 L2 架构 | 多链 Client、Optimistic vs ZK Rollup |
| **Day 34**    | L2 开发        | CrossDomainMessenger、L1↔L2 消息传递 |
| **Day 35**    | 安全与合规     | MEV/Flashbots、KMS、审计             |
| **Day 36-37** | 结业项目       | 企业级双链支付网关 + E2E 测试套件    |

---

## 学习资源推荐

### Golang Blockchain Libraries
1. **go-ethereum (geth)** - 官方 ETH 客户端与库 (必看 code analysis)
2. **btcsuite** - 完整的 Bitcoin 协议 Go 实现
3. **lnd** - Lightning Network Daemon (Go 实现)
4. **cosmos-sdk** - 著名的 Go 区块链框架 (扩展阅读)

### Foundry & Solidity
5. **Foundry Book (中文版)** - 必读，Foundry 官方文档
6. **OpenZeppelin Contracts** - 合约标准库

### 账户抽象 (ERC-4337)
7. **ERC-4337 官方文档** - 账户抽象标准规范
8. **eth-infinitism/account-abstraction** - 官方参考实现
9. **Stackup Docs** - Bundler 开发指南

### DeFi 协议
10. **Uniswap V3 Development Book** - V3 合约架构详解
11. **Aave V3 Documentation** - 借贷协议官方文档
12. **DeFi Developer Road Map** - DeFi 开发路线图

### 进阶阅读
13. **Paradigm Engineering Blog** - 深入理解底层（Rust/Go 视角）
14. **Flashbots Docs** - 理解 MEV 和私密交易
15. **Go Ethereum Book** - 经典的 Geth 开发指南

### 参考源码
16. **optimism** - `op-node` 和 `op-batcher` 是极好的 Go 链上交互范例
17. **rainbow-me/rainbow** - 优秀的钱包实现参考
18. **Uniswap/v3-periphery** - Router 合约实现参考