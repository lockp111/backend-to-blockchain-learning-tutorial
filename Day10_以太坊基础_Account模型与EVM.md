# Day 10: ä»¥å¤ªåŠåŸºç¡€ â€” Account æ¨¡å‹ä¸ EVM

> **å­¦ä¹ æ—¶é—´**ï¼š4-6 å°æ—¶ï¼ˆç†è®º 2h + å®æˆ˜ 3h + å¤ä¹  0.5hï¼‰
>
> **æ ¸å¿ƒç›®æ ‡**ï¼šç†è§£ä»¥å¤ªåŠçš„ Account æ¨¡å‹å’Œ EVM æ¶æ„ï¼Œå®Œæˆ Go å¼€å‘ç¯å¢ƒé…ç½®

---

## ğŸ¯ ä»Šæ—¥å­¦ä¹ ç›®æ ‡

- [ ] ç†è§£ Account æ¨¡å‹ä¸ UTXO æ¨¡å‹çš„æœ¬è´¨å·®å¼‚
- [ ] æŒæ¡ EOA å’Œ Contract Account çš„åŒºåˆ«
- [ ] ç†è§£ EVM çš„æ¶æ„è®¾è®¡ä¸ Gas æœºåˆ¶
- [ ] äº†è§£ MPTï¼ˆMerkle Patricia Trieï¼‰çŠ¶æ€å­˜å‚¨åŸç†
- [ ] é…ç½® Go å¼€å‘ç¯å¢ƒå¹¶è¿æ¥ä»¥å¤ªåŠèŠ‚ç‚¹

---

## ğŸ“š ç†è®ºè¯¾ï¼šä» Bitcoin åˆ° Ethereum

### UTXO vs Account æ¨¡å‹

è¿™æ˜¯åŒºå—é“¾æ¶æ„ä¸­æœ€é‡è¦çš„ä¸¤ç§çŠ¶æ€ç®¡ç†æ–¹å¼ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    UTXO vs Account æ¨¡å‹å¯¹æ¯”                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                    â”‚
â”‚  Bitcoin (UTXO)                      Ethereum (Account)            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚                      â”‚           â”‚                      â”‚       â”‚
â”‚  â”‚   æ²¡æœ‰"è´¦æˆ·"æ¦‚å¿µ      â”‚           â”‚   æœ‰å…¨å±€è´¦æˆ·çŠ¶æ€      â”‚       â”‚
â”‚  â”‚   åªæœ‰æœªèŠ±è´¹çš„è¾“å‡º    â”‚           â”‚   è´¦æˆ·æœ‰ä½™é¢å­—æ®µ      â”‚       â”‚
â”‚  â”‚                      â”‚           â”‚                      â”‚       â”‚
â”‚  â”‚   ä½™é¢ = Î£(UTXO)     â”‚           â”‚   ä½™é¢ = state[addr] â”‚       â”‚
â”‚  â”‚                      â”‚           â”‚                      â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚                                                                    â”‚
â”‚  ç±»æ¯”ï¼š                              ç±»æ¯”ï¼š                         â”‚
â”‚  â€¢ ä½ çš„é’±åŒ…é‡Œæœ‰ 3 å¼ çº¸å¸              â€¢ é“¶è¡Œè´¦æˆ·æ˜¾ç¤ºä½™é¢ 150         â”‚
â”‚  â€¢ 100 + 30 + 20 = 150               â€¢ ç›´æ¥è¯»å–æ•°å­—                â”‚
â”‚  â€¢ ä»˜æ¬¾æ—¶æ‰¾é›¶                        â€¢ ç›´æ¥åŠ å‡ä½™é¢                 â”‚
â”‚                                                                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                    â”‚
â”‚  ä¼˜åŠ¿å¯¹æ¯”ï¼š                                                         â”‚
â”‚                                                                    â”‚
â”‚  UTXO ä¼˜åŠ¿ï¼š                         Account ä¼˜åŠ¿ï¼š                 â”‚
â”‚  âœ“ éšç§æ€§å¥½ï¼ˆæ¯æ¬¡æ–°åœ°å€ï¼‰             âœ“ æ¨¡å‹ç®€å•ç›´è§‚                 â”‚
â”‚  âœ“ å¹¶è¡ŒéªŒè¯ï¼ˆæ— å…±äº«çŠ¶æ€ï¼‰             âœ“ æ™ºèƒ½åˆçº¦å‹å¥½                 â”‚
â”‚  âœ“ äº¤æ˜“ç‹¬ç«‹æ€§                        âœ“ çŠ¶æ€æŸ¥è¯¢é«˜æ•ˆ                 â”‚
â”‚                                                                    â”‚
â”‚  UTXO åŠ£åŠ¿ï¼š                         Account åŠ£åŠ¿ï¼š                 â”‚
â”‚  âœ— å¤æ‚åˆçº¦å›°éš¾                      âœ— éœ€è¦ Nonce é˜²é‡æ”¾            â”‚
â”‚  âœ— çŠ¶æ€æŸ¥è¯¢ä½æ•ˆ                      âœ— å¹¶å‘å¤„ç†å¤æ‚                 â”‚
â”‚  âœ— æ‰¾é›¶ç®¡ç†å¤æ‚                      âœ— éšç§æ€§è¾ƒå·®                   â”‚
â”‚                                                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### ä»¥å¤ªåŠè´¦æˆ·ç±»å‹

#### EOAï¼ˆExternally Owned Accountï¼‰

ç”±ç§é’¥æ§åˆ¶çš„æ™®é€šè´¦æˆ·ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         EOA è´¦æˆ·ç»“æ„                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                â”‚
â”‚  åœ°å€: 0x742d35Cc6634C0532925a3b844Bc9e7595f...                â”‚
â”‚                                                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  nonce: 42           // å·²å‘é€äº¤æ˜“æ•°é‡                    â”‚  â”‚
â”‚  â”‚  balance: 5.2 ETH    // è´¦æˆ·ä½™é¢ (Wei)                   â”‚  â”‚
â”‚  â”‚  storageRoot: empty  // EOA æ²¡æœ‰å­˜å‚¨                     â”‚  â”‚
â”‚  â”‚  codeHash: empty     // EOA æ²¡æœ‰ä»£ç                      â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                â”‚
â”‚  ç‰¹ç‚¹ï¼š                                                        â”‚
â”‚  â€¢ ç”±ç§é’¥æ§åˆ¶                                                  â”‚
â”‚  â€¢ å¯ä»¥å‘èµ·äº¤æ˜“                                                â”‚
â”‚  â€¢ æ²¡æœ‰ä»£ç                                                    â”‚
â”‚  â€¢ åœ°å€ = Keccak256(publicKey)[12:]                           â”‚
â”‚                                                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### Contract Account

ç”±ä»£ç æ§åˆ¶çš„åˆçº¦è´¦æˆ·ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      Contract è´¦æˆ·ç»“æ„                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                â”‚
â”‚  åœ°å€: 0xC02aaA39b223FE8D0A0e5C4F27eAD9083C756Cc2 (WETH)       â”‚
â”‚                                                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  nonce: 1            // åˆ›å»ºåˆçº¦æ•°é‡ï¼ˆé€šå¸¸ä¸º 1ï¼‰          â”‚  â”‚
â”‚  â”‚  balance: 2.8M ETH   // åˆçº¦æŒæœ‰çš„ ETH                   â”‚  â”‚
â”‚  â”‚  storageRoot: 0x...  // å­˜å‚¨æ ‘æ ¹å“ˆå¸Œ                     â”‚  â”‚
â”‚  â”‚  codeHash: 0x...     // åˆçº¦ä»£ç å“ˆå¸Œ                     â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                â”‚
â”‚  ç‰¹ç‚¹ï¼š                                                        â”‚
â”‚  â€¢ ç”±ä»£ç é€»è¾‘æ§åˆ¶                                              â”‚
â”‚  â€¢ ä¸èƒ½ä¸»åŠ¨å‘èµ·äº¤æ˜“ï¼ˆåªèƒ½å“åº”ï¼‰                                 â”‚
â”‚  â€¢ æœ‰æŒä¹…åŒ–å­˜å‚¨ (Storage)                                      â”‚
â”‚  â€¢ åœ°å€ = Keccak256(RLP(sender, nonce))[12:]                  â”‚
â”‚         æˆ– CREATE2: Keccak256(0xff, sender, salt, codeHash)   â”‚
â”‚                                                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### EVMï¼ˆEthereum Virtual Machineï¼‰

#### æ¶æ„æ¦‚è§ˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          EVM æ¶æ„                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                        äº¤æ˜“æ‰§è¡Œ                              â”‚   â”‚
â”‚  â”‚  Transaction â†’ EVM â†’ State Transition â†’ New State           â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                    â”‚
â”‚  EVM è¿è¡Œæ—¶ç¯å¢ƒï¼š                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                                                              â”‚  â”‚
â”‚  â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚  â”‚
â”‚  â”‚   â”‚   Stack    â”‚  â”‚   Memory   â”‚  â”‚     Storage        â”‚     â”‚  â”‚
â”‚  â”‚   â”‚            â”‚  â”‚            â”‚  â”‚                    â”‚     â”‚  â”‚
â”‚  â”‚   â”‚  256-bit   â”‚  â”‚  byte æ•°ç»„  â”‚  â”‚   key-value å­˜å‚¨   â”‚     â”‚  â”‚
â”‚  â”‚   â”‚  æœ€å¤§1024  â”‚  â”‚  æ˜“å¤±æ€§     â”‚  â”‚   æŒä¹…åŒ–           â”‚     â”‚  â”‚
â”‚  â”‚   â”‚  LIFO      â”‚  â”‚  æŒ‰éœ€æ‰©å±•   â”‚  â”‚   Slot ä¸ºå•ä½      â”‚     â”‚  â”‚
â”‚  â”‚   â”‚            â”‚  â”‚            â”‚  â”‚                    â”‚     â”‚  â”‚
â”‚  â”‚   â”‚  Gas: 3    â”‚  â”‚ Gas: 3/æ‰©å±• â”‚  â”‚  Gas: 100~20000   â”‚     â”‚  â”‚
â”‚  â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚  â”‚
â”‚  â”‚                                                              â”‚  â”‚
â”‚  â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚  â”‚
â”‚  â”‚   â”‚                    Program Counter                   â”‚    â”‚  â”‚
â”‚  â”‚   â”‚                    (PC æŒ‡å‘å½“å‰æŒ‡ä»¤)                  â”‚    â”‚  â”‚
â”‚  â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚  â”‚
â”‚  â”‚                                                              â”‚  â”‚
â”‚  â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚  â”‚
â”‚  â”‚   â”‚                    Call Data                         â”‚    â”‚  â”‚
â”‚  â”‚   â”‚                    (äº¤æ˜“è¾“å…¥æ•°æ®)                     â”‚    â”‚  â”‚
â”‚  â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚  â”‚
â”‚  â”‚                                                              â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### æ ¸å¿ƒæ“ä½œç åˆ†ç±»

| ç±»åˆ«       | æ“ä½œç ç¤ºä¾‹                      | è¯´æ˜            |
| ---------- | ------------------------------- | --------------- |
| **æ ˆæ“ä½œ** | PUSH, POP, DUP, SWAP            | æ•°æ®å‹å…¥/å¼¹å‡ºæ ˆ |
| **ç®—æœ¯**   | ADD, MUL, SUB, DIV, MOD         | æ•°å­¦è¿ç®—        |
| **æ¯”è¾ƒ**   | LT, GT, EQ, ISZERO              | æ¡ä»¶åˆ¤æ–­        |
| **ä½æ“ä½œ** | AND, OR, XOR, NOT, SHL, SHR     | ä½è¿ç®—          |
| **å†…å­˜**   | MLOAD, MSTORE, MSTORE8          | å†…å­˜è¯»å†™        |
| **å­˜å‚¨**   | SLOAD, SSTORE                   | æŒä¹…åŒ–å­˜å‚¨è¯»å†™  |
| **æµç¨‹**   | JUMP, JUMPI, STOP, RETURN       | æ§åˆ¶æµ          |
| **ç¯å¢ƒ**   | CALLER, CALLVALUE, GAS, BALANCE | è·å–ä¸Šä¸‹æ–‡      |
| **è°ƒç”¨**   | CALL, DELEGATECALL, STATICCALL  | è·¨åˆçº¦è°ƒç”¨      |

---

### Gas æœºåˆ¶

#### ä¸ºä»€ä¹ˆéœ€è¦ Gasï¼Ÿ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     Gas æœºåˆ¶è®¾è®¡ç›®çš„                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                â”‚
â”‚  1. é˜²æ­¢æ— é™å¾ªç¯                                                â”‚
â”‚     â€¢ æ¯æ¡æŒ‡ä»¤æ¶ˆè€— Gas                                         â”‚
â”‚     â€¢ Gas è€—å°½åˆ™äº¤æ˜“å›æ»š                                       â”‚
â”‚     â€¢ é˜²æ­¢ DoS æ”»å‡»                                            â”‚
â”‚                                                                â”‚
â”‚  2. èµ„æºå®šä»·                                                   â”‚
â”‚     â€¢ è®¡ç®—ã€å­˜å‚¨ã€å¸¦å®½éƒ½éœ€è¦æˆæœ¬                                â”‚
â”‚     â€¢ Gas è®©ç”¨æˆ·ä¸ºæ¶ˆè€—çš„èµ„æºä»˜è´¹                               â”‚
â”‚     â€¢ æ¿€åŠ±èŠ‚ç‚¹å¤„ç†äº¤æ˜“                                         â”‚
â”‚                                                                â”‚
â”‚  3. å¸‚åœºæœºåˆ¶                                                   â”‚
â”‚     â€¢ ç”¨æˆ·è®¾ç½® Gas Priceï¼ˆæ„¿æ„æ”¯ä»˜çš„ä»·æ ¼ï¼‰                      â”‚
â”‚     â€¢ çŸ¿å·¥ä¼˜å…ˆæ‰“åŒ…é«˜ä»·äº¤æ˜“                                     â”‚
â”‚     â€¢ æ‹¥å µæ—¶ä»·æ ¼è‡ªç„¶ä¸Šæ¶¨                                       â”‚
â”‚                                                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### Gas è®¡ç®—

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      Gas è´¹ç”¨è®¡ç®—                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                â”‚
â”‚  EIP-1559 è´¹ç”¨æ¨¡å‹ï¼ˆLondon å‡çº§åï¼‰ï¼š                           â”‚
â”‚                                                                â”‚
â”‚  æ€»è´¹ç”¨ = Gas Used Ã— (Base Fee + Priority Fee)                 â”‚
â”‚                                                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                                                          â”‚  â”‚
â”‚  â”‚  Gas Limit: 21000        // ç”¨æˆ·è®¾ç½®çš„ä¸Šé™               â”‚  â”‚
â”‚  â”‚  Gas Used:  21000        // å®é™…æ¶ˆè€—                     â”‚  â”‚
â”‚  â”‚  Base Fee:  30 Gwei      // åè®®å†³å®šï¼Œç‡ƒçƒ§                â”‚  â”‚
â”‚  â”‚  Priority Fee: 2 Gwei    // ç»™çŸ¿å·¥çš„å°è´¹                  â”‚  â”‚
â”‚  â”‚                                                          â”‚  â”‚
â”‚  â”‚  æ€»è´¹ç”¨ = 21000 Ã— (30 + 2) = 672,000 Gwei               â”‚  â”‚
â”‚  â”‚         = 0.000672 ETH                                  â”‚  â”‚
â”‚  â”‚                                                          â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                â”‚
â”‚  å¸¸è§æ“ä½œçš„ Gas æ¶ˆè€—ï¼š                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ æ“ä½œ                              â”‚ Gas æ¶ˆè€—              â”‚ â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
â”‚  â”‚ ETH è½¬è´¦                          â”‚ 21,000               â”‚ â”‚
â”‚  â”‚ ERC-20 Transfer                   â”‚ ~65,000              â”‚ â”‚
â”‚  â”‚ Uniswap Swap                      â”‚ ~150,000             â”‚ â”‚
â”‚  â”‚ NFT Mint                          â”‚ ~80,000              â”‚ â”‚
â”‚  â”‚ åˆçº¦éƒ¨ç½²                          â”‚ ~500,000+            â”‚ â”‚
â”‚  â”‚ SSTORE (æ–°å€¼)                     â”‚ 20,000               â”‚ â”‚
â”‚  â”‚ SSTORE (ä¿®æ”¹)                     â”‚ 5,000                â”‚ â”‚
â”‚  â”‚ SLOAD                             â”‚ 2,100                â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### MPTï¼ˆMerkle Patricia Trieï¼‰

ä»¥å¤ªåŠä½¿ç”¨ MPT å­˜å‚¨æ‰€æœ‰çŠ¶æ€æ•°æ®ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       MPT çŠ¶æ€å­˜å‚¨                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                    â”‚
â”‚  World State Trie (å…¨å±€çŠ¶æ€æ ‘)                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                                                              â”‚  â”‚
â”‚  â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                     â”‚  â”‚
â”‚  â”‚              â”‚  Root   â”‚ â† Block Header ä¸­çš„ stateRoot       â”‚  â”‚
â”‚  â”‚              â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜                                     â”‚  â”‚
â”‚  â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                â”‚  â”‚
â”‚  â”‚         â–¼         â–¼         â–¼                                â”‚  â”‚
â”‚  â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”                       â”‚  â”‚
â”‚  â”‚    â”‚ Branch  â”‚ â”‚ Branch  â”‚ â”‚ Leaf    â”‚                       â”‚  â”‚
â”‚  â”‚    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                       â”‚  â”‚
â”‚  â”‚         â”‚           â”‚                                        â”‚  â”‚
â”‚  â”‚         â–¼           â–¼                                        â”‚  â”‚
â”‚  â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                   â”‚  â”‚
â”‚  â”‚    â”‚ Account â”‚ â”‚ Account â”‚                                   â”‚  â”‚
â”‚  â”‚    â”‚  State  â”‚ â”‚  State  â”‚                                   â”‚  â”‚
â”‚  â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                   â”‚  â”‚
â”‚  â”‚                                                              â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                    â”‚
â”‚  æ¯ä¸ªè´¦æˆ·çš„å­˜å‚¨ä¹Ÿæ˜¯ä¸€ä¸ª MPTï¼ˆStorage Trieï¼‰ï¼š                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                                                              â”‚  â”‚
â”‚  â”‚  Account State:                                              â”‚  â”‚
â”‚  â”‚  {                                                           â”‚  â”‚
â”‚  â”‚    nonce: 5,                                                 â”‚  â”‚
â”‚  â”‚    balance: 100 ETH,                                         â”‚  â”‚
â”‚  â”‚    storageRoot: 0x... â†’ Storage Trie Root                    â”‚  â”‚
â”‚  â”‚    codeHash: 0x...                                           â”‚  â”‚
â”‚  â”‚  }                                                           â”‚  â”‚
â”‚  â”‚                                                              â”‚  â”‚
â”‚  â”‚  Storage Trie (slot â†’ value):                                â”‚  â”‚
â”‚  â”‚  {                                                           â”‚  â”‚
â”‚  â”‚    slot[0]: æ€»ä¾›åº”é‡,                                         â”‚  â”‚
â”‚  â”‚    slot[1]: ç®¡ç†å‘˜åœ°å€,                                       â”‚  â”‚
â”‚  â”‚    keccak256(address || 2): ç”¨æˆ·ä½™é¢æ˜ å°„,                     â”‚  â”‚
â”‚  â”‚    ...                                                       â”‚  â”‚
â”‚  â”‚  }                                                           â”‚  â”‚
â”‚  â”‚                                                              â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### MPT çš„ä¼˜åŠ¿

1. **é«˜æ•ˆéªŒè¯**ï¼šåªéœ€ O(log n) çš„è¯æ˜è·¯å¾„
2. **å¢é‡æ›´æ–°**ï¼šä¿®æ”¹åªéœ€æ›´æ–°è·¯å¾„ä¸Šçš„èŠ‚ç‚¹
3. **å†å²çŠ¶æ€**ï¼šå¯ä»¥è®¿é—®ä»»æ„åŒºå—çš„çŠ¶æ€ï¼ˆArchive Nodeï¼‰

---

### äº¤æ˜“ç»“æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     Ethereum äº¤æ˜“ç»“æ„                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                â”‚
â”‚  Legacy Transaction (Type 0):                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  nonce:    42                  // å‘é€è€…äº¤æ˜“åºå·          â”‚  â”‚
â”‚  â”‚  gasPrice: 30 Gwei             // Gas å•ä»·               â”‚  â”‚
â”‚  â”‚  gasLimit: 21000               // Gas ä¸Šé™               â”‚  â”‚
â”‚  â”‚  to:       0x742d35...         // æ¥æ”¶åœ°å€               â”‚  â”‚
â”‚  â”‚  value:    1 ETH               // è½¬è´¦é‡‘é¢               â”‚  â”‚
â”‚  â”‚  data:     0x...               // è°ƒç”¨æ•°æ®               â”‚  â”‚
â”‚  â”‚  v, r, s:  ç­¾å                                          â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                â”‚
â”‚  EIP-1559 Transaction (Type 2):                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  chainId:             1          // é“¾ ID                â”‚  â”‚
â”‚  â”‚  nonce:               42                                 â”‚  â”‚
â”‚  â”‚  maxPriorityFeePerGas: 2 Gwei    // å°è´¹ä¸Šé™             â”‚  â”‚
â”‚  â”‚  maxFeePerGas:         50 Gwei   // æœ€å¤§è´¹ç”¨ä¸Šé™          â”‚  â”‚
â”‚  â”‚  gasLimit:             21000                             â”‚  â”‚
â”‚  â”‚  to:                   0x742d35...                       â”‚  â”‚
â”‚  â”‚  value:                1 ETH                             â”‚  â”‚
â”‚  â”‚  data:                 0x...                             â”‚  â”‚
â”‚  â”‚  accessList:           []        // é¢„çƒ­å­˜å‚¨æ§½           â”‚  â”‚
â”‚  â”‚  v, r, s:              ç­¾å                              â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ› ï¸ å®æˆ˜ä½œä¸š

### ä½œä¸š 1ï¼šGo å¼€å‘ç¯å¢ƒé…ç½®

#### 1.1 é¡¹ç›®åˆå§‹åŒ–

```bash
mkdir -p ~/blockchain-course/day10-eth-basics
cd ~/blockchain-course/day10-eth-basics
go mod init eth-basics

# å®‰è£… go-ethereum
go get github.com/ethereum/go-ethereum
```

#### 1.2 è¿æ¥é…ç½®

```go
// config/config.go
package config

// EthConfig ä»¥å¤ªåŠè¿æ¥é…ç½®
type EthConfig struct {
    // å…¬å…± RPC èŠ‚ç‚¹ï¼ˆå¼€å‘æµ‹è¯•ç”¨ï¼‰
    RPCURL string
    
    // WebSocket URLï¼ˆç”¨äºè®¢é˜…ï¼‰
    WSURL string
    
    // é“¾ ID
    ChainID int64
}

// é¢„è®¾é…ç½®
var (
    MainnetConfig = EthConfig{
        RPCURL:  "https://eth-mainnet.g.alchemy.com/v2/YOUR_API_KEY",
        WSURL:   "wss://eth-mainnet.g.alchemy.com/v2/YOUR_API_KEY",
        ChainID: 1,
    }
    
    SepoliaConfig = EthConfig{
        RPCURL:  "https://eth-sepolia.g.alchemy.com/v2/YOUR_API_KEY",
        WSURL:   "wss://eth-sepolia.g.alchemy.com/v2/YOUR_API_KEY",
        ChainID: 11155111,
    }
    
    // Anvil æœ¬åœ°èŠ‚ç‚¹
    LocalConfig = EthConfig{
        RPCURL:  "http://127.0.0.1:8545",
        WSURL:   "ws://127.0.0.1:8545",
        ChainID: 31337,
    }
)
```

---

### ä½œä¸š 2ï¼šåŸºç¡€å®¢æˆ·ç«¯å°è£…

```go
// client/eth_client.go
package client

import (
    "context"
    "fmt"
    "math/big"
    
    "github.com/ethereum/go-ethereum/common"
    "github.com/ethereum/go-ethereum/core/types"
    "github.com/ethereum/go-ethereum/ethclient"
)

// EthClient ä»¥å¤ªåŠå®¢æˆ·ç«¯å°è£…
type EthClient struct {
    client  *ethclient.Client
    chainID *big.Int
}

// NewEthClient åˆ›å»ºä»¥å¤ªåŠå®¢æˆ·ç«¯
func NewEthClient(rpcURL string) (*EthClient, error) {
    client, err := ethclient.Dial(rpcURL)
    if err != nil {
        return nil, fmt.Errorf("è¿æ¥èŠ‚ç‚¹å¤±è´¥: %w", err)
    }
    
    chainID, err := client.ChainID(context.Background())
    if err != nil {
        return nil, fmt.Errorf("è·å– Chain ID å¤±è´¥: %w", err)
    }
    
    return &EthClient{
        client:  client,
        chainID: chainID,
    }, nil
}

// Close å…³é—­è¿æ¥
func (c *EthClient) Close() {
    c.client.Close()
}

// ChainID è·å–é“¾ ID
func (c *EthClient) ChainID() *big.Int {
    return c.chainID
}

// BlockNumber è·å–æœ€æ–°åŒºå—å·
func (c *EthClient) BlockNumber(ctx context.Context) (uint64, error) {
    return c.client.BlockNumber(ctx)
}

// GetBalance è·å–åœ°å€ä½™é¢
func (c *EthClient) GetBalance(ctx context.Context, address string) (*big.Int, error) {
    addr := common.HexToAddress(address)
    return c.client.BalanceAt(ctx, addr, nil) // nil = latest block
}

// GetBalanceAtBlock è·å–æŒ‡å®šåŒºå—çš„ä½™é¢
func (c *EthClient) GetBalanceAtBlock(ctx context.Context, address string, blockNum *big.Int) (*big.Int, error) {
    addr := common.HexToAddress(address)
    return c.client.BalanceAt(ctx, addr, blockNum)
}

// GetNonce è·å–åœ°å€çš„ nonce
func (c *EthClient) GetNonce(ctx context.Context, address string) (uint64, error) {
    addr := common.HexToAddress(address)
    return c.client.NonceAt(ctx, addr, nil)
}

// GetPendingNonce è·å–å¾…å¤„ç†çš„ nonceï¼ˆåŒ…å« pending äº¤æ˜“ï¼‰
func (c *EthClient) GetPendingNonce(ctx context.Context, address string) (uint64, error) {
    addr := common.HexToAddress(address)
    return c.client.PendingNonceAt(ctx, addr)
}

// GetBlock è·å–åŒºå—ä¿¡æ¯
func (c *EthClient) GetBlock(ctx context.Context, blockNum *big.Int) (*types.Block, error) {
    return c.client.BlockByNumber(ctx, blockNum)
}

// GetLatestBlock è·å–æœ€æ–°åŒºå—
func (c *EthClient) GetLatestBlock(ctx context.Context) (*types.Block, error) {
    return c.client.BlockByNumber(ctx, nil)
}

// GetTransaction è·å–äº¤æ˜“
func (c *EthClient) GetTransaction(ctx context.Context, txHash string) (*types.Transaction, bool, error) {
    hash := common.HexToHash(txHash)
    return c.client.TransactionByHash(ctx, hash)
}

// GetTransactionReceipt è·å–äº¤æ˜“å›æ‰§
func (c *EthClient) GetTransactionReceipt(ctx context.Context, txHash string) (*types.Receipt, error) {
    hash := common.HexToHash(txHash)
    return c.client.TransactionReceipt(ctx, hash)
}

// SuggestGasPrice è·å–å»ºè®®çš„ Gas Price
func (c *EthClient) SuggestGasPrice(ctx context.Context) (*big.Int, error) {
    return c.client.SuggestGasPrice(ctx)
}

// SuggestGasTipCap è·å–å»ºè®®çš„å°è´¹ï¼ˆEIP-1559ï¼‰
func (c *EthClient) SuggestGasTipCap(ctx context.Context) (*big.Int, error) {
    return c.client.SuggestGasTipCap(ctx)
}
```

---

### ä½œä¸š 3ï¼šåŒºå—ä¿¡æ¯æŸ¥è¯¢

```go
// examples/query_block/main.go
package main

import (
    "context"
    "fmt"
    "log"
    "math/big"
    "time"
    
    "eth-basics/client"
)

func main() {
    // è¿æ¥ Sepolia æµ‹è¯•ç½‘ï¼ˆæˆ–æœ¬åœ° Anvilï¼‰
    ethClient, err := client.NewEthClient("https://eth-sepolia.g.alchemy.com/v2/YOUR_KEY")
    if err != nil {
        log.Fatalf("è¿æ¥å¤±è´¥: %v", err)
    }
    defer ethClient.Close()
    
    ctx, cancel := context.WithTimeout(context.Background(), 30*time.Second)
    defer cancel()
    
    // 1. è·å–é“¾ä¿¡æ¯
    chainID := ethClient.ChainID()
    blockNum, _ := ethClient.BlockNumber(ctx)
    
    fmt.Printf("=== é“¾ä¿¡æ¯ ===\n")
    fmt.Printf("Chain ID: %d\n", chainID)
    fmt.Printf("æœ€æ–°åŒºå—: %d\n", blockNum)
    
    // 2. è·å–æœ€æ–°åŒºå—è¯¦æƒ…
    block, err := ethClient.GetLatestBlock(ctx)
    if err != nil {
        log.Fatalf("è·å–åŒºå—å¤±è´¥: %v", err)
    }
    
    fmt.Printf("\n=== æœ€æ–°åŒºå— ===\n")
    fmt.Printf("åŒºå—å·: %d\n", block.Number())
    fmt.Printf("åŒºå—å“ˆå¸Œ: %s\n", block.Hash().Hex())
    fmt.Printf("çˆ¶åŒºå—: %s\n", block.ParentHash().Hex())
    fmt.Printf("æ—¶é—´æˆ³: %s\n", time.Unix(int64(block.Time()), 0))
    fmt.Printf("äº¤æ˜“æ•°: %d\n", len(block.Transactions()))
    fmt.Printf("Gas Used: %d\n", block.GasUsed())
    fmt.Printf("Gas Limit: %d\n", block.GasLimit())
    fmt.Printf("Base Fee: %s Gwei\n", weiToGwei(block.BaseFee()))
    
    // 3. æŸ¥è¯¢è´¦æˆ·ä½™é¢
    vitalikAddr := "0xd8dA6BF26964aF9D7eEd9e03E53415D37aA96045"
    balance, err := ethClient.GetBalance(ctx, vitalikAddr)
    if err != nil {
        log.Printf("æŸ¥è¯¢ä½™é¢å¤±è´¥: %v", err)
    } else {
        fmt.Printf("\n=== Vitalik ä½™é¢ ===\n")
        fmt.Printf("åœ°å€: %s\n", vitalikAddr)
        fmt.Printf("ä½™é¢: %s ETH\n", weiToEth(balance))
    }
    
    // 4. è·å– Gas ä»·æ ¼å»ºè®®
    gasPrice, _ := ethClient.SuggestGasPrice(ctx)
    gasTip, _ := ethClient.SuggestGasTipCap(ctx)
    
    fmt.Printf("\n=== Gas å»ºè®® ===\n")
    fmt.Printf("å»ºè®® Gas Price: %s Gwei\n", weiToGwei(gasPrice))
    fmt.Printf("å»ºè®® Priority Fee: %s Gwei\n", weiToGwei(gasTip))
}

// weiToEth å°† Wei è½¬æ¢ä¸º ETH
func weiToEth(wei *big.Int) string {
    if wei == nil {
        return "0"
    }
    ethValue := new(big.Float).SetInt(wei)
    ethValue.Quo(ethValue, big.NewFloat(1e18))
    return ethValue.Text('f', 6)
}

// weiToGwei å°† Wei è½¬æ¢ä¸º Gwei
func weiToGwei(wei *big.Int) string {
    if wei == nil {
        return "0"
    }
    gweiValue := new(big.Float).SetInt(wei)
    gweiValue.Quo(gweiValue, big.NewFloat(1e9))
    return gweiValue.Text('f', 2)
}
```

---

### ä½œä¸š 4ï¼šä½¿ç”¨ Anvil æœ¬åœ°å¼€å‘

#### 4.1 å¯åŠ¨ Anvil

```bash
# å®‰è£… Foundry (å¦‚æœè¿˜æ²¡æœ‰)
curl -L https://foundry.paradigm.xyz | bash
foundryup

# å¯åŠ¨ Anvil
anvil

# è¾“å‡º:
# Available Accounts
# ==================
# (0) 0xf39Fd6e51aad88F6F4ce6aB8827279cffFb92266 (10000 ETH)
# (1) 0x70997970C51812dc3A010C7d01b50e0d17dc79C8 (10000 ETH)
# ...
#
# Private Keys
# ==================
# (0) 0xac0974bec39a17e36ba4a6b4d238ff944bacb478cbed5efcae784d7bf4f2ff80
# ...
#
# Listening on 127.0.0.1:8545
```

#### 4.2 è¿æ¥æœ¬åœ°èŠ‚ç‚¹

```go
// examples/local_anvil/main.go
package main

import (
    "context"
    "fmt"
    "log"
    "time"
    
    "eth-basics/client"
)

func main() {
    // è¿æ¥æœ¬åœ° Anvil
    ethClient, err := client.NewEthClient("http://127.0.0.1:8545")
    if err != nil {
        log.Fatalf("è¿æ¥å¤±è´¥: %v", err)
    }
    defer ethClient.Close()
    
    ctx, cancel := context.WithTimeout(context.Background(), 10*time.Second)
    defer cancel()
    
    // æŸ¥è¯¢ Anvil é¢„ç½®è´¦æˆ·ä½™é¢
    testAccount := "0xf39Fd6e51aad88F6F4ce6aB8827279cffFb92266"
    
    balance, err := ethClient.GetBalance(ctx, testAccount)
    if err != nil {
        log.Fatalf("æŸ¥è¯¢ä½™é¢å¤±è´¥: %v", err)
    }
    
    nonce, err := ethClient.GetNonce(ctx, testAccount)
    if err != nil {
        log.Fatalf("æŸ¥è¯¢ nonce å¤±è´¥: %v", err)
    }
    
    fmt.Printf("Anvil æµ‹è¯•è´¦æˆ·: %s\n", testAccount)
    fmt.Printf("ä½™é¢: %s Wei (10000 ETH)\n", balance.String())
    fmt.Printf("Nonce: %d\n", nonce)
    fmt.Printf("Chain ID: %d\n", ethClient.ChainID())
}
```

---

### ä½œä¸š 5ï¼šäº¤æ˜“æŸ¥è¯¢ä¸è§£æ

```go
// examples/parse_tx/main.go
package main

import (
    "context"
    "fmt"
    "log"
    "math/big"
    "time"
    
    "eth-basics/client"
    
    "github.com/ethereum/go-ethereum/common"
    "github.com/ethereum/go-ethereum/core/types"
)

func main() {
    ethClient, err := client.NewEthClient("https://eth-mainnet.g.alchemy.com/v2/YOUR_KEY")
    if err != nil {
        log.Fatalf("è¿æ¥å¤±è´¥: %v", err)
    }
    defer ethClient.Close()
    
    ctx, cancel := context.WithTimeout(context.Background(), 30*time.Second)
    defer cancel()
    
    // æŸ¥è¯¢ä¸€ç¬”è‘—åäº¤æ˜“ï¼šVitalik ç»™ Uniswap çš„æèµ 
    txHash := "0x..." // æ›¿æ¢ä¸ºå®é™…äº¤æ˜“å“ˆå¸Œ
    
    tx, isPending, err := ethClient.GetTransaction(ctx, txHash)
    if err != nil {
        log.Fatalf("æŸ¥è¯¢äº¤æ˜“å¤±è´¥: %v", err)
    }
    
    fmt.Printf("=== äº¤æ˜“è¯¦æƒ… ===\n")
    fmt.Printf("å“ˆå¸Œ: %s\n", tx.Hash().Hex())
    fmt.Printf("å¾…å¤„ç†: %v\n", isPending)
    fmt.Printf("ç±»å‹: %d\n", tx.Type())
    fmt.Printf("Nonce: %d\n", tx.Nonce())
    fmt.Printf("Gas Limit: %d\n", tx.Gas())
    
    // æ ¹æ®äº¤æ˜“ç±»å‹æ˜¾ç¤º Gas ä¿¡æ¯
    switch tx.Type() {
    case types.LegacyTxType:
        fmt.Printf("Gas Price: %s Gwei\n", weiToGwei(tx.GasPrice()))
    case types.DynamicFeeTxType:
        fmt.Printf("Max Fee: %s Gwei\n", weiToGwei(tx.GasFeeCap()))
        fmt.Printf("Max Priority Fee: %s Gwei\n", weiToGwei(tx.GasTipCap()))
    }
    
    fmt.Printf("Value: %s ETH\n", weiToEth(tx.Value()))
    
    if tx.To() != nil {
        fmt.Printf("To: %s\n", tx.To().Hex())
    } else {
        fmt.Printf("To: (åˆçº¦åˆ›å»º)\n")
    }
    
    fmt.Printf("Data: %x...\n", tx.Data()[:min(len(tx.Data()), 32)])
    
    // è·å–äº¤æ˜“å›æ‰§
    receipt, err := ethClient.GetTransactionReceipt(ctx, txHash)
    if err != nil {
        log.Printf("è·å–å›æ‰§å¤±è´¥: %v", err)
        return
    }
    
    fmt.Printf("\n=== äº¤æ˜“å›æ‰§ ===\n")
    fmt.Printf("çŠ¶æ€: %d (1=æˆåŠŸ, 0=å¤±è´¥)\n", receipt.Status)
    fmt.Printf("åŒºå—å·: %d\n", receipt.BlockNumber)
    fmt.Printf("Gas Used: %d\n", receipt.GasUsed)
    fmt.Printf("æ—¥å¿—æ•°é‡: %d\n", len(receipt.Logs))
    
    if receipt.ContractAddress != (common.Address{}) {
        fmt.Printf("åˆ›å»ºçš„åˆçº¦: %s\n", receipt.ContractAddress.Hex())
    }
}

func weiToEth(wei *big.Int) string {
    if wei == nil {
        return "0"
    }
    ethValue := new(big.Float).SetInt(wei)
    ethValue.Quo(ethValue, big.NewFloat(1e18))
    return ethValue.Text('f', 6)
}

func weiToGwei(wei *big.Int) string {
    if wei == nil {
        return "0"
    }
    gweiValue := new(big.Float).SetInt(wei)
    gweiValue.Quo(gweiValue, big.NewFloat(1e9))
    return gweiValue.Text('f', 2)
}

func min(a, b int) int {
    if a < b {
        return a
    }
    return b
}
```

---

## ğŸ“ çŸ¥è¯†ç‚¹æ€»ç»“

### æ ¸å¿ƒæ¦‚å¿µå¯¹æ¯”

| æ¦‚å¿µ         | Bitcoin        | Ethereum     |
| ------------ | -------------- | ------------ |
| **çŠ¶æ€æ¨¡å‹** | UTXO           | Account      |
| **ä½™é¢è¡¨ç¤º** | æœªèŠ±è´¹è¾“å‡ºæ€»å’Œ | è´¦æˆ·å­—æ®µ     |
| **äº¤æ˜“åºå·** | æ—              | Nonce        |
| **æ™ºèƒ½åˆçº¦** | æœ‰é™è„šæœ¬       | å›¾çµå®Œå¤‡ EVM |
| **çŠ¶æ€å­˜å‚¨** | æ—              | MPT          |
| **è´¹ç”¨æ¨¡å‹** | æŒ‰å­—èŠ‚         | æŒ‰ Gas       |

### EVM ä¸‰å±‚å­˜å‚¨

| å­˜å‚¨        | ç”Ÿå‘½å‘¨æœŸ | Gas æˆæœ¬ | ç”¨é€”       |
| ----------- | -------- | -------- | ---------- |
| **Stack**   | æŒ‡ä»¤çº§   | æä½     | è®¡ç®—       |
| **Memory**  | äº¤æ˜“çº§   | ä½       | ä¸´æ—¶æ•°æ®   |
| **Storage** | æ°¸ä¹…     | é«˜       | çŠ¶æ€æŒä¹…åŒ– |

---

## âœ… ä»Šæ—¥æ£€æŸ¥æ¸…å•

- [ ] ç†è§£äº† UTXO å’Œ Account æ¨¡å‹çš„æœ¬è´¨å·®å¼‚
- [ ] æŒæ¡äº† EOA å’Œ Contract Account çš„åŒºåˆ«
- [ ] ç†è§£äº† EVM çš„ Stack/Memory/Storage æ¶æ„
- [ ] ç†è§£äº† Gas æœºåˆ¶å’Œ EIP-1559 è´¹ç”¨æ¨¡å‹
- [ ] æˆåŠŸé…ç½®äº† Go å¼€å‘ç¯å¢ƒ
- [ ] èƒ½å¤Ÿè¿æ¥èŠ‚ç‚¹å¹¶æŸ¥è¯¢åŒºå—å’Œä½™é¢ä¿¡æ¯

---

## ğŸ”— å‚è€ƒèµ„æº

### å®˜æ–¹æ–‡æ¡£
- [go-ethereum æ–‡æ¡£](https://geth.ethereum.org/docs)
- [Ethereum é»„çš®ä¹¦](https://ethereum.github.io/yellowpaper/paper.pdf)
- [EVM Opcodes](https://www.evm.codes/)

### å·¥å…·
- [Etherscan](https://etherscan.io/) - åŒºå—æµè§ˆå™¨
- [Foundry](https://book.getfoundry.sh/) - å¼€å‘å·¥å…·
- [Alchemy](https://www.alchemy.com/) / [Infura](https://infura.io/) - RPC æœåŠ¡

---

## ğŸ“Œ æ˜æ—¥é¢„å‘Š

**Day 11: ä»¥å¤ªåŠäº¤æ˜“ä¸ Go å®¢æˆ·ç«¯å¼€å‘**
- äº¤æ˜“æ„é€ ä¸ç­¾åæµç¨‹
- Nonce ç®¡ç†ä¸ Gas ä¼°ç®—
- Multicall æ‰¹é‡è°ƒç”¨ä¼˜åŒ–
- Rate Limiting æµæ§å®ç°
